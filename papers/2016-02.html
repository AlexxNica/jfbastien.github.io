<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Inconsolata:bold' rel='stylesheet' type='text/css'>
    <style>
      body {
        font-family: 'Roboto', sans-serif;
      }
      .body {
        margin: 0 auto;
        max-width: 80em;
      }
      a {
        color: #455A64;
      }
      h1, h2, h3, h4, h5, h6 {
        color: #37474F;
      }
      h1 a, h2 a, h3 a, h4 a, h5 a, h6 a {
        padding-left: 1em;
        padding-right: 3em;
        text-decoration: none;
        opacity: 0;
      }
      a.headerlink:hover {
        opacity: 1;
      }
      .field-name {
        text-align: right;
        padding-right: 1em;
      }
      tt, .highlight {
        color: #263238;
        background-color: #ECEFF1;
        font-family: 'Inconsolata', monospace;
        font-weight: bold;
      }
      tt {
        padding: 0em 0.5em;
      }
      .highlight {
        margin: 0em 1em;
        padding: 0.1em 1em;
      }
    </style>
    <title>Happy with C++17</title> 
  </head>
  <body>
    <div class="body">

  <div class="section" id="happy-with-c-17">
<h1>Happy with C++17<a class="headerlink" href="#happy-with-c-17" title="Permalink to this headline">¶</a></h1>
<div class="section" id="a-jacksonville-trip-report">
<h2>A Jacksonville trip report<a class="headerlink" href="#a-jacksonville-trip-report" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Author:</th><td class="field-body">JF Bastien</td>
</tr>
<tr class="field-even field"><th class="field-name">Contact:</th><td class="field-body"><a class="reference external" href="mailto:jfb&#37;&#52;&#48;google&#46;com">jfb<span>&#64;</span>google<span>&#46;</span>com</a></td>
</tr>
<tr class="field-odd field"><th class="field-name">Date:</th><td class="field-body">2016-03-06</td>
</tr>
<tr class="field-even field"><th class="field-name">URL:</th><td class="field-body"><a class="reference external" href="https://github.com/jfbastien/papers/blob/master/source/2016-02.rst">https://github.com/jfbastien/papers/blob/master/source/2016-02.rst</a></td>
</tr>
</tbody>
</table>
<p>I just came back from the C++ standards committee in Jacksonville, and I’m not surprised by what the committee voted into C++17. In fact, I’m quite enthused by what we got, and what we’ll get in subsequent C++ version. C++17 will have <a class="reference external" href="http://open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0218r0.html">filesystem</a>, <a class="reference external" href="http://open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0024r1.html">parallelism</a>, <a class="reference external" href="http://open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0220r0.html">library fundamentals</a>, <a class="reference external" href="http://open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0226r0.pdf">special math</a>, a bunch of <a class="reference external" href="http://libcxx.llvm.org/cxx1z_status.html">library fixes</a> and <a class="reference external" href="http://clang.llvm.org/cxx_status.html#cxx17">language fixes</a>.</p>
<blockquote>
<div></div></blockquote>
<p>It’s not a major release but neither is it a minor release: it’s a release of what the committee deemed ready to ship because C++ now releases on a “train” schedule.</p>
<p>I’m happy, so why is the internet <a class="reference external" href="https://www.reddit.com/r/cpp/comments/48zp05/what_we_added_to_the_c17_working_draft/">angry</a>? You were <a class="reference external" href="http://www.infoq.com/news/2015/04/stroustrup-cpp17-interview">promised</a> more in multiple web publications as well as conferences such as <a class="reference external" href="https://www.youtube.com/watch?v=p1fqdl6sLMY&amp;list=PLHTh1InhhwT75gykhs7pqcR_uSiG601oh&amp;index=66">CppCon</a>. Or rather, the committee was overly optimistic when it publicly stated what <em>could</em> be in C++17, and the internet rightfully interpreted this as what <em>would</em> be in C++17. Sure reddit is angry. You know what? It always has a base of anger, and they have a right to be angry because they were promised something!</p>
<blockquote>
<div></div></blockquote>
<p>C++ doesn’t just need cheerleaders who gets developers enthused: it also needs leaders who focuses the committee to ship great features. Anything else leads to disappointment and discord as we have now. I hope this has taught all of us a lesson and brings the committee together.</p>
<p>What’s in C++17 is great, and I find it insulting to say C++17 has nothing. Consider the parallelism TS: NVIDIA and Intel, who you’d think aren’t best buds, came together on that one and delivered. <em>You</em> may not care much for it, but the high-performance computing people love it. They also love the special math functions. Same thing for filesystem which, despite <a class="reference external" href="https://en.wikipedia.org/wiki/Time_of_check_to_time_of_use">TOCTOU</a> security concerns for multi-user systems, made it to C++17. All of these are incremental steps, future C++ releases will build on them. It’s not perfect but it’s pretty damn good.</p>
<blockquote>
<div></div></blockquote>
<p>Many experts voted against the features that didn’t get through. Concepts not getting through shouldn’t be a surprise to anyone on the committee. Consider:</p>
<ul class="simple">
<li>The author of ranges—which uses concepts extensively—is <a class="reference external" href="https://twitter.com/ericniebler/status/702871869435711488">surprised anyone wants to ship it</a> (despite his reservation, Eric voted <em>for</em> concepts because his experience told him C++ was better with them than without).</li>
<li>The technical specification was only published late last year.</li>
<li>A single not-yet-released compiler implements concepts, and was driven by the proposal authors.</li>
<li>The core languages working group sent concepts back to the language evolution group.</li>
<li>The experts in the room voted against it.</li>
<li>Multiple national bodies objected to it.</li>
</ul>
<p>All signs that something was wrong with concepts. Everyone on the committee <em>wants</em> concepts in the language, but the voting shows that a substantial number of experts didn&#8217;t deem them ready to ship. If you were paying attention to the standards committee then you knew this was coming. Unfortunately, if you were paying attention to interviews and conferences then you’re disappointed because your expectations were set on getting concepts. For that the committee should be sorry.</p>
<blockquote>
<div></div></blockquote>
<p>We don’t just want shiny features in C++, we want features which will mature well instead of adding more gotchas. This release helps dampen the old gotchas <em>and</em> it adds functionality without, I hope, adding new gotchas.</p>
<p>Compare to Chrome which also does release trains. You miss the train: too bad, wait for the next one in 6 weeks. Chrome still manages to release significant features and trains are <a class="reference external" href="https://www.chromium.org/developers/calendar">usually on time</a>. People don’t get angry when a Chrome feature slips by a release or two. Actually that’s not true, people still get angry because internet. But you know what? People get angrier when we ship something that’s broken.</p>
<blockquote>
<div></div></blockquote>
<p>C++ may move to a 2-year train, down from its current 3-year target. C++19 hold a lot of promise if people actually collaborate instead of staking their honor on promised features. Let’s not disappoint the internet again!</p>
<p>More and more people are participating in the committee. I’m enthused to see that ARM is now represented, and AMD started attending at the previous meeting. They’re joining hardware vendors such as IBM, NVIDIA and Intel who care because C++ allows developers to better use their hardware, which is becoming critical as Moore’s law dies off. Similarly we’ve got increased participation from the US national labs who work on Exascale and high-performance computing problems. Same for gaming folks, who are joining forces with the finance industry in making C++ shine for low-latency usecases. C++ is you, if your industry isn’t represented you should consider sending a representative!</p>
<p>The committee failed you in setting the wrong expectations. Let’s not do that again. As <a class="reference external" href="https://twitter.com/isotrumpp">ISO Trump++</a> says, <tt class="docutils literal"><span class="pre">let’s</span> <span class="pre">make</span> <span class="pre">C++</span> <span class="pre">operator</span> <span class="pre">&gt;</span> <span class="pre">again</span></tt>! Thank you Jacksonville, FL, you did it!</p>
<blockquote>
<div></div></blockquote>
</div>
<div class="section" id="a-few-details-from-the-concurrency-and-parallelism-sub-group">
<h2>A few details from the concurrency and parallelism sub-group<a class="headerlink" href="#a-few-details-from-the-concurrency-and-parallelism-sub-group" title="Permalink to this headline">¶</a></h2>
<p>This is the sub-group I attended during the entire week. Here’s an overview of what we discussed. Look for the follow-up papers in the post-Jacksonville mailing, which should come out in about 3 weeks.</p>
<ul class="simple">
<li>We’re going to work on concurrency TS2, which will extend what’s already in <a class="reference external" href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2015/n4399.html">concurrency TS1</a>, as well as parallelism TS2 to follow up what we just shipped in C++17.</li>
<li><a class="reference external" href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0206r0.html">std::thread and RAII</a> creates a new “safe” thread function which joins when an exception is thrown.</li>
<li><a class="reference external" href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0250r0.html">Initialization and thread ids</a> wording was improved. This is full of ill-specified corner cases around thread IDs, static constructors, initialization order, the ID of <cite>main</cite>, and has implications with dynamic linking.</li>
<li>We’re making significant progress in fixing <a class="reference external" href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0190r0.pdf">memory_order_consume</a>, which is especially useful for concurrent datastructures on ARM and Power. Most importantly we’re now trying to restrict it to only pointers being allowed to carry dependencies which meets the usecase Linux has for consume. Pointer tagging won’t be met in the first version because the C++ language itself needs to support it before consume can. Paul had a great start on defining the semantics of consume, and I’ll work with him to move this forward.</li>
<li><a class="reference external" href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0072r1.pdf">Light-weight execution agents</a> also made good progress here as well as with the core working group. It’ll make it easier to standardize execution agents which don’t offer strong forward-progress guarantees by clarifying blocking and obstruction-freedom.</li>
<li>We removed <cite>plain old function</cite> from the language and improved compatibility with <a class="reference external" href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0270r0.html">signals</a> by defining which functionality can be used from a signal handler.</li>
<li>Extensive discussion on <a class="reference external" href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0193r0.html">vectorization in C++</a>, which has gotten interest from the gaming and low-latency group as well.<ul>
<li><a class="reference external" href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0075r1.pdf">Parallel for loop</a> and <a class="reference external" href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0076r1.pdf">Wavefront</a> made progress, allowing developers to express parallelism and dependencies with the goal of getting some vectorization. There are still issues around gather / scatter memory operation ordering, but we’re otherwise moving this to the next parallelism TS.</li>
<li><a class="reference external" href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0214r0.pdf">Vector types</a> and extra <a class="reference external" href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0203r0.html">considerations</a> for their design is in a great shape. We’re still worried about what shuffles will look like, we’re adding some math functions to the specification, and are getting close to putting this into a TS.</li>
</ul>
</li>
<li><a class="reference external" href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0260r0.html">Concurrent queue</a> and <a class="reference external" href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0261r0.html">distributed counters</a> had quite long API design discussions, trying to find what a minimal API could be and whether memory ordering was required in the API.</li>
<li><a class="reference external" href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0058r1.pdf">Abstract execution</a> and <a class="reference external" href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0285r0.html">executors</a> were briefly discussed, as neither of the authors for executors were present. We’re still hoping to get executors into a TS soon, but have to reconcile both designs.</li>
<li><a class="reference external" href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0019r1.html">Atomic view</a> saw significant fixes, and there’s still doubt that this is needed beyond being an upgrade mechanism for older code which hasn’t fully moved to modern C++.</li>
<li><a class="reference external" href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0020r1.html">Floating-point atomics</a> are being moved to the library working groups, and we’re receiving collaboration from ARM on the paper. The new revision will be exciting!</li>
<li><a class="reference external" href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0126r1.pdf">Synchronic</a> moved to the library working groups, with the goal of being in the new concurrency TS.</li>
<li><a class="reference external" href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0232r0.pdf">Concurrency toolkit</a> was an entertaining read and a good introduction to <a class="reference external" href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0233r0.pdf">Hazard pointers</a>, <a class="reference external" href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0279r0.html">RCU</a>, and the <a class="reference external" href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0124r1.html">Linux memory model</a>. The papers still have a “C” feel to them, and we’re working with the authors to bring these to C++ in a better API.</li>
<li>There was an entire evening session on massive parallelism with <a class="reference external" href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0234r0.pdf">HPX</a> and <a class="reference external" href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0236r0.pdf">OpenCL</a>.</li>
<li>We fixed a bunch of issues reported through the core working group.</li>
</ul>
<p>Ain’t that a train that we’re setting up future C++ releases! And that’s just from the concurrency and parallelism sub-group, one of <a class="reference external" href="https://isocpp.org/std/the-committee">14 sub-groups</a>.</p>
<blockquote>
<div></div></blockquote>
</div>
<div class="section" id="upcoming-gaming-and-low-latency-sub-group-meeting">
<h2>Upcoming gaming and low-latency sub-group meeting<a class="headerlink" href="#upcoming-gaming-and-low-latency-sub-group-meeting" title="Permalink to this headline">¶</a></h2>
<p>I’m <a class="reference external" href="https://groups.google.com/a/isocpp.org/d/topic/sg14/qnbWDK9t0gY/discussion">hosting</a> the gaming and low-latency sub-group at the Google San-Francisco office on March 14th, during <a class="reference external" href="http://www.gdconf.com">GDC</a>. Let me or Michael Wong know if you’re interested in attending.</p>
<blockquote>
<div></div></blockquote>
</div>
<div class="section" id="next-meeting">
<h2>Next meeting<a class="headerlink" href="#next-meeting" title="Permalink to this headline">¶</a></h2>
<p>The next <a class="reference external" href="https://isocpp.org/std/meetings-and-participation/upcoming-meetings">meeting</a> is in Oulu, Finland, at the end of June. It’s so far North during the summer solstice that no evening sessions will be held as there will be no evenings.</p>
<blockquote>
<div></div></blockquote>
</div>
</div>


    </div>
  </body>
</html>